<div id="container-lista" class="container-fluid bg-dark h-100">
    <div class="row position-relative justify-content-center align-items-center">
        <button id="filtros" matTooltip="Filtros de clases" #filtros mat-icon-button
            [matMenuTriggerFor]="menuClases" class="filtros bg-accent">
            <mat-icon>filter_alt</mat-icon>
        </button>
        <mat-menu id="containerMenu" #menuClases="matMenu" class="me-1 menu-filtros-estandar menu-clases-filtros">
            <div id="menu">
                <mat-form-field (click)="$event.stopPropagation();" (keyup)="filtroClases();">
                    <mat-label>Incluye texto</mat-label>
                    <input #claseTextInc matInput placeholder="Texto a buscar">
                </mat-form-field>
                <mat-form-field (click)="$event.stopPropagation();">
                    <mat-label>Manual</mat-label>
                    <mat-select appearance="fill" [(value)]="defaultManual" (selectionChange)="filtroClases();">
                        <mat-option *ngFor="let m of manuales" [value]="m">{{m}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="filtros-chips">
                <mat-chip-option color="warn" class="filtro-chip" [selected]="incluirHomebrew"
                    (click)="$event.stopPropagation(); alternarHomebrew();">{{anuncioHomebrew}}</mat-chip-option>
                <mat-chip-option color="accent" class="filtro-chip" [selected]="soloPrestigio"
                    (click)="$event.stopPropagation(); alternarPrestigio();">{{anuncioPrestigio}}</mat-chip-option>
                <mat-chip-option color="accent" class="filtro-chip" [selected]="ocultarConPrerrequisitos"
                    (click)="$event.stopPropagation(); alternarFiltroPrerrequisitos();">{{anuncioPrerrequisitos}}</mat-chip-option>
            </div>
        </mat-menu>

        <table id="clases" #tablaClases mat-table [dataSource]="clasesDS" matSort *ngIf="clases.length > 0; else cargando">
            <ng-container matColumnDef="{{column}}" *ngFor="let column of claseColumns">
                <th class="lead" mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Ordenar por {{column}}">
                    {{column == 'Nivel_max_claseo' ? 'Nivel máximo' : column == 'Prestigio' ? 'De prestigio' : column.replace('_', ' ')}}
                </th>
                <td mat-cell *matCellDef="let element">
                    <button mat-stroked-button matTooltip="Clic para ver esta clase" [matTooltipShowDelay]="200" *ngIf="column == 'Nombre'" color="accent"
                        class="d-flex justify-content-start sombra3d w-100" (click)="verDetallesClase(element.Id); $event.stopPropagation();">
                        <mat-icon>read_more</mat-icon>
                        {{element[column]}}
                    </button>
                    <p class="mb-0" *ngIf="column == 'Manual'">
                        {{element.Manual?.Nombre}} (p. {{element.Manual?.Pagina}})
                    </p>
                    <p class="mb-0" *ngIf="column == 'Tipo_dado'">
                        {{element.Tipo_dado?.Nombre}}
                    </p>
                    <p class="mb-0" *ngIf="column == 'Puntos_habilidad'">
                        {{element.Puntos_habilidad?.Valor}}
                    </p>
                    <p class="mb-0 text-center" *ngIf="column == 'Nivel_max_claseo'">
                        {{element.Nivel_max_claseo}}
                    </p>
                    <div class="d-flex justify-content-center align-items-center" *ngIf="column == 'Prestigio'">
                        <mat-checkbox [checked]="element.Prestigio" [disableRipple]="true"
                            (click)="$event.preventDefault(); $event.stopPropagation();"></mat-checkbox>
                    </div>
                    <div class="d-flex justify-content-center align-items-center" *ngIf="column == 'Prerrequisitos'">
                        <mat-checkbox [checked]="tienePrerrequisitos(element)" [disableRipple]="true"
                            (click)="$event.preventDefault(); $event.stopPropagation();"></mat-checkbox>
                    </div>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="claseColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let element; columns: claseColumns;" class="element-row elegir"
                (click)="seleccionarClase(element.Id)"></tr>
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell text-center text-white p-3" [attr.colspan]="claseColumns.length">
                    Ninguna clase encaja con los filtros
                </td>
            </tr>
        </table>
        <ng-template #cargando>
            <div class="superballs">
                <div class="superballs__dot"></div>
                <div class="superballs__dot"></div>
            </div>
        </ng-template>
    </div>
    <div class="row justify-content-center align-items-center">
        <mat-paginator [pageSizeOptions]="[10, 20, 30, 40]" showFirstLastButtons aria-label="Selecciona una página de clases">
        </mat-paginator>
    </div>
</div>
